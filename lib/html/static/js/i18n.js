(function(){
  const STORAGE_KEY = 'apw_lang';
  const defaultLang = 'zh';

  const dict = {
    zh: {
      common: {
        toggle: 'ä¸­/EN',
        welcome_guest: 'æ¬¢è¿ï¼Œæ¸¸å®¢',
        welcome_user: 'æ¬¢è¿ï¼Œ{username}',
        history: 'æŸ¥çœ‹å†å²',
        logout: 'é€€å‡ºç™»å½•',
        back_home: 'è¿”å›é¦–é¡µ',
        loading: 'åŠ è½½ä¸­...',
        load_failed: 'åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•',
        confirm: 'ç¡®å®š',
        cancel: 'å–æ¶ˆ',
        // æ–°å¢ï¼šä½™é¢ä¸å•ä½
        balance: 'ä½™é¢',
        credit_unit: 'æ£€ç´¢ç‚¹',
        billing: 'æ£€ç´¢è´¦å•',
        // å†å²è®°å½•ç›¸å…³
        history_title: 'å†å²è®°å½•',
        no_history: 'æš‚æ— å†å²è®°å½•',
        loading_history: 'æ­£åœ¨åŠ è½½å†å²è®°å½•...',
        load_history_failed: 'åŠ è½½å†å²è®°å½•å¤±è´¥'
      },
      index: {
        title: 'AutoPaperWeb ç ”ç©¶åŠ©æ‰‹',
        user_greeting: 'ä½ å¥½ï¼Œ{username}',
        research_config: 'ğŸ” ç ”ç©¶é…ç½®',
        question_label: 'ç ”ç©¶é—®é¢˜',
        question_ph: 'è¯·è¾“å…¥æ‚¨çš„ç ”ç©¶é—®é¢˜ï¼Œä¾‹å¦‚ï¼šæœºå™¨å­¦ä¹ åœ¨åŒ»ç–—è¯Šæ–­ä¸­çš„åº”ç”¨ç°çŠ¶å¦‚ä½•ï¼Ÿ',
        req_label: 'ç ”ç©¶è¦æ±‚',
        req_ph: 'è¯·è¾“å…¥å…·ä½“è¦æ±‚ï¼Œä¾‹å¦‚ï¼šéœ€è¦åŒ…å«æœ€æ–°çš„æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼Œé‡ç‚¹å…³æ³¨å‡†ç¡®æ€§å’Œå¯è§£é‡Šæ€§',
        time_range: 'ğŸ“… æ—¶é—´èŒƒå›´',
        include_all_years: 'åŒ…å«æ‰€æœ‰å¹´ä»½',
        start_year: 'èµ·å§‹å¹´ä»½ï¼š',
        end_year: 'ç»“æŸå¹´ä»½ï¼š',
        folders_title: 'ğŸ“ æ•°æ®æºé€‰æ‹©',
        select_all: 'å…¨é€‰',
        select_none: 'å…¨ä¸é€‰',
        loading_folders: 'æ­£åœ¨åŠ è½½æ•°æ®æº...',
        no_folders: 'æš‚æ— å¯ç”¨æ•°æ®æº',
        update_stats: 'ğŸ”„ æ›´æ–°ç»Ÿè®¡',
        start_search: 'ğŸš€ å¼€å§‹æ£€ç´¢',
        selected_count: 'å·²é€‰æ‹©æ–‡ç« æ•°ï¼š{count}',
        estimated_cost: 'é¢„è®¡èŠ±è´¹ç‚¹æ•°ï¼š{cost}',
        need_select_journal: 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæœŸåˆŠæˆ–ä¼šè®®',
        insufficient_balance: 'ä½™é¢ä¸è¶³ï¼Œæ— æ³•å¼€å§‹æ£€ç´¢',
        filter_panel: 'ç­›é€‰æ¡ä»¶',
        available_journals: 'å¯é€‰æœŸåˆŠ/ä¼šè®®',
        selected_journals: 'å·²é€‰æœŸåˆŠ/ä¼šè®®',
        journal_type: 'åˆŠç‰©ç±»å‹',
        journal_source: 'åˆŠç‰©æ¥æº',
        major_category: 'å¤§ç±»å­¦ç§‘',
        minor_category: 'å°ç±»å­¦ç§‘',
        expand: 'å±•å¼€',
        collapse: 'æ”¶èµ·',
        add_journal: 'æ·»åŠ ',
        remove_journal: 'ç§»é™¤',
        clear_all: 'æ¸…ç©ºå…¨éƒ¨',
        clear_tags: 'æ¸…é™¤å·²å‹¾é€‰æ ‡ç­¾',
        journal_count: 'æœŸåˆŠæ•°é‡ï¼š{count}',
        paper_count: 'è®ºæ–‡æ•°é‡ï¼š{count}',
        loading_tags: 'æ­£åœ¨åŠ è½½æ ‡ç­¾...',
        loading_journals: 'æ­£åœ¨åŠ è½½æœŸåˆŠ...',
        no_journals_found: 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æœŸåˆŠ',
        journal_info: '{name} | {range} | æ›´æ–°ï¼š{date}',
        update_success: 'æˆåŠŸæ›´æ–°ç»Ÿè®¡ï¼Œå…±æ‰¾åˆ° {count} ç¯‡ç›¸å…³æ–‡ç« ',
        update_empty: 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ç« ï¼Œè¯·è°ƒæ•´ç­›é€‰æ¡ä»¶',
        need_select_folder: 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ•°æ®æº',
        updating: 'æ­£åœ¨å¤„ç†...',
        login_missing: 'æœªè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•',
        err_no_question: 'è¯·è¾“å…¥ç ”ç©¶é—®é¢˜',
        err_invalid_year: 'è¯·è¾“å…¥åˆæ³•çš„4ä½å¹´ä»½ï¼ˆèµ·æ­¢å¹´ä»½å‡éœ€å¡«å†™æˆ–å‹¾é€‰åŒ…å«æ‰€æœ‰å¹´ä»½ï¼‰',
        err_year_order: 'ç»“æŸå¹´ä»½ä¸èƒ½å°äºèµ·å§‹å¹´ä»½',
        search_journals_ph: 'æœç´¢æœŸåˆŠæˆ–ä¼šè®®åç§°...',
        // å†å²è®°å½•ç›¸å…³
        new_search: 'æ–°å»ºæœç´¢',
        current: 'å½“å‰',
        history_collapse: 'æŠ˜å å†å²è®°å½•',
        history_expand: 'å±•å¼€å†å²è®°å½•',
        // è¯´æ˜è§†å›¾å¡ç‰‡ç›¸å…³
        search_summary_title: 'ğŸ” æ£€ç´¢æ¦‚è§ˆ',
        back_to_input: 'è¿”å›ç¼–è¾‘',
        research_question: 'ç ”ç©¶é—®é¢˜',
        research_requirements: 'ç ”ç©¶è¦æ±‚',
        time_range_summary: 'æ—¶é—´èŒƒå›´',
        selected_journals_summary: 'å·²é€‰æœŸåˆŠ',
        start_time_summary: 'å¼€å§‹æ—¶é—´',
        progress_title: 'æ£€ç´¢è¿›åº¦',
        status_running: 'è¿è¡Œä¸­',
        status_paused: 'å·²æš‚åœ',
        pause: 'æš‚åœ',
        resume: 'æ¢å¤',
        pause_confirm: 'ç¡®å®šè¦æš‚åœæ£€ç´¢å—ï¼Ÿ',
        resume_confirm: 'ç¡®å®šè¦æ¢å¤æ£€ç´¢å—ï¼Ÿ',
        pause_success: 'æ£€ç´¢å·²æš‚åœ',
        resume_success: 'æ£€ç´¢å·²æ¢å¤',
        pause_fail: 'æš‚åœæ£€ç´¢å¤±è´¥',
        resume_fail: 'æ¢å¤æ£€ç´¢å¤±è´¥',
        terminate: 'ç»ˆæ­¢',
        terminate_confirm: 'ç¡®å®šè¦ç»ˆæ­¢æ­¤ä»»åŠ¡å—ï¼Ÿç»ˆæ­¢åæ— æ³•æ¢å¤ï¼Œå·²å¤„ç†çš„éƒ¨åˆ†å°†ä¿ç•™ã€‚',
        terminate_success: 'ä»»åŠ¡å·²ç»ˆæ­¢',
        terminate_fail: 'ç»ˆæ­¢å¤±è´¥',
        terminate_complete: 'ä»»åŠ¡ç»ˆæ­¢ï¼ˆå¯ä¸‹è½½å·²å®Œæˆæ£€ç´¢çš„éƒ¨åˆ†ï¼‰',
        operation_failed: 'æ“ä½œå¤±è´¥',
        completion_title: 'æ£€ç´¢å®Œæˆ',
        download_all_results: 'ä¸‹è½½å…¨éƒ¨åˆ†æç»“æœ',
        download_bib_results: 'ä¸‹è½½ç›¸ç¬¦ç»“æœçš„bibå¼•ç”¨',
        distill: 'è’¸é¦',
        delete: 'åˆ é™¤',
        // è’¸é¦ç›¸å…³
        distill_input_title: 'è’¸é¦è¾“å…¥',
        distill_new: 'æ–°å»º',
        distill_question: 'è’¸é¦ç ”ç©¶é—®é¢˜',
        distill_question_ph: 'è¯·è¾“å…¥æ–°çš„ç ”ç©¶é—®é¢˜ï¼Œå°†åŸºäºåŸå§‹æŸ¥è¯¢çš„ç›¸å…³ç»“æœè¿›è¡Œè’¸é¦æ£€ç´¢',
        distill_requirements: 'è’¸é¦ç ”ç©¶è¦æ±‚',
        distill_requirements_ph: 'è¯·è¾“å…¥å…·ä½“è¦æ±‚ï¼Œä¾‹å¦‚ï¼šé‡ç‚¹å…³æ³¨æœ€æ–°æ–¹æ³•ã€ç‰¹å®šåº”ç”¨åœºæ™¯ç­‰',
        distill_paper_count: 'ç›¸å…³è®ºæ–‡æ•°é‡ï¼š{count}',
        distill_estimated_cost: 'é¢„è®¡æ¶ˆè€—æ£€ç´¢ç‚¹ï¼š{cost}',
        distill_user_balance: 'å½“å‰ä½™é¢ï¼š{balance}',
        distill_insufficient_balance: 'ä½™é¢ä¸è¶³ï¼Œæ— æ³•å¼€å§‹è’¸é¦',
        distill_estimate_failed: 'è´¹ç”¨ä¼°ç®—å¤±è´¥',
        distill_no_question: 'è¯·è¾“å…¥è’¸é¦ç ”ç©¶é—®é¢˜',
        distill_start_success: 'è’¸é¦æ£€ç´¢åˆ›å»ºæˆåŠŸ',
        distill_start_failed: 'è’¸é¦æ£€ç´¢åˆ›å»ºå¤±è´¥',
        distill_summary_title: 'è’¸é¦æ£€ç´¢',
        distill_running: 'è¿›è¡Œä¸­',
        distill_completed: 'å·²å®Œæˆ',
        distillation_completed: 'è’¸é¦å·²å®Œæˆ',
        download_result: 'ä¸‹è½½ç»“æœ',
        distill_start_time: 'å¼€å§‹æ—¶é—´',
        distill_progress_title: 'è’¸é¦è¿›åº¦',
        distill_completion_title: 'è’¸é¦å®Œæˆ',
        distill_again: 'å†æ¬¡è’¸é¦',
        distill_pause_not_supported: 'è’¸é¦æš‚åœåŠŸèƒ½æš‚æœªæ”¯æŒ',
        estimate_cost: 'ä¼°ç®—è´¹ç”¨',
        start_distillation: 'å¼€å§‹è’¸é¦',
        collapse: 'æŠ˜å ',
        expand: 'å±•å¼€',
        close: 'å…³é—­',
        no_special_requirements: 'æ— ç‰¹æ®Šè¦æ±‚',
        download_success: 'ä¸‹è½½æˆåŠŸ',
        download_failed: 'ä¸‹è½½å¤±è´¥',
        distill_confirm: 'ç¡®å®šè¦è’¸é¦æ­¤æ£€ç´¢å—ï¼Ÿ',
        delete_confirm: 'ç¡®å®šè¦åˆ é™¤æ­¤æ£€ç´¢å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
        delete_success: 'æ£€ç´¢å·²åˆ é™¤',
        delete_failed: 'åˆ é™¤æ£€ç´¢å¤±è´¥',
        total_articles: 'æ–‡ç« æ€»æ•°',
        estimated_cost_summary: 'é¢„è®¡èŠ±è´¹',
        search_status: 'æ£€ç´¢çŠ¶æ€',
        status_running: 'è¿è¡Œä¸­',
        // æ–°å¢ï¼šç¡¬ç¼–ç æ–‡æœ¬å›½é™…åŒ–
        updated: 'æ›´æ–°',
        fetch_failed: 'è·å–å¤±è´¥',
        no_tags: 'æš‚æ— æ ‡ç­¾',
        load_failed_short: 'åŠ è½½å¤±è´¥',
        distill_in_progress: 'è’¸é¦æ£€ç´¢è¿›è¡Œä¸­',
        no_journals_search: 'æœªæ‰¾åˆ°åŒ…å«"{keyword}"çš„æœŸåˆŠ',
        no_journals_filter: 'æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æœŸåˆŠ',
        add_from_left: 'è¯·ä»å·¦ä¾§æ·»åŠ æœŸåˆŠ',
        all_years: 'æ‰€æœ‰å¹´ä»½',
        history_task_title: 'å†å²ä»»åŠ¡',
        distill_task_title: 'è’¸é¦æ£€ç´¢ä»»åŠ¡',
        loading_history_details: 'æ­£åœ¨åŠ è½½ä»»åŠ¡è¯¦æƒ…...',
        load_history_details_failed: 'åŠ è½½ä»»åŠ¡è¯¦æƒ…å¤±è´¥',
        view_results: 'æŸ¥çœ‹ç»“æœ',
        download_results: 'ä¸‹è½½ç»“æœ',
        view_progress: 'æŸ¥çœ‹è¿›åº¦',
        create_distill: 'åˆ›å»ºè’¸é¦',
        retry: 'é‡è¯•',
        feature_coming_soon: 'åŠŸèƒ½å³å°†æ¨å‡º',
        login_required: 'è¯·ç™»å½•',
        loading_short: 'åŠ è½½ä¸­...',
        estimated_cost_points: 'é¢„è®¡èŠ±è´¹ç‚¹æ•°',
        selected_folders: 'é€‰æ‹©çš„æ•°æ®æº',
        year_range: 'å¹´ä»½èŒƒå›´',
        // è’¸é¦ç±»å‹å†å²é¡¹ç›®ä¸“ç”¨æ ‡ç­¾
        distill_original_question_requirements: 'è¢«è’¸é¦çš„ç ”ç©¶é—®é¢˜å’Œè¦æ±‚',
        distill_original_time: 'è¢«è’¸é¦çš„æ£€ç´¢å‘ç”Ÿçš„æ—¶é—´ç‚¹',
        // é”™è¯¯æ¶ˆæ¯
        update_stats_failed: 'æ›´æ–°ç»Ÿè®¡å¤±è´¥ï¼š{msg}',
        start_search_failed: 'å¼€å§‹æ£€ç´¢å¤±è´¥ï¼š{msg}',
        fetch_balance_failed: 'è·å–ä½™é¢å¤±è´¥',
        // è’¸é¦å¡ç‰‡æ ‡ç­¾
        related_papers_count: 'ç›¸å…³è®ºæ–‡æ•°é‡ï¼š',
        estimated_consumption: 'é¢„è®¡æ¶ˆè€—æ£€ç´¢ç‚¹ï¼š',
        current_balance: 'å½“å‰ä½™é¢ï¼š',
        // åŠ è½½é”™è¯¯æ¶ˆæ¯
        load_journals_failed: 'åŠ è½½æœŸåˆŠå¤±è´¥: {msg}',
        // ä¸‹è½½ç›¸å…³ï¼ˆå¼‚æ­¥é˜Ÿåˆ—æ¨¡å¼ï¼‰
        download_queued: 'ä¸‹è½½ä»»åŠ¡å·²åˆ›å»º',
        download_processing: 'æ­£åœ¨ç”Ÿæˆæ–‡ä»¶...',
        download_ready: 'æ–‡ä»¶å·²å°±ç»ª',
        download_progress: 'æ’é˜Ÿä¸­ï¼Œé¢„è®¡ç­‰å¾…{time}ç§’',
        download_generating: 'æ­£åœ¨ç”Ÿæˆæ–‡ä»¶...',
        download_please_wait: 'æ–‡ä»¶ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...',
      },
      login: {
        title: 'ç”¨æˆ·ç™»å½•',
        username: 'ç”¨æˆ·åï¼š',
        password: 'å¯†ç ï¼š',
        submit: 'ç™»å½•',
        submitting: 'ç™»å½•ä¸­...',
        to_register: 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹å‡»æ³¨å†Œ',
        fill_all: 'è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ',
        net_fail: 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥',
      },
      register: {
        title: 'ç”¨æˆ·æ³¨å†Œ',
        username: 'ç”¨æˆ·åï¼š',
        password: 'å¯†ç ï¼š',
        confirm: 'ç¡®è®¤å¯†ç ï¼š',
        submit: 'æ³¨å†Œ',
        submitting: 'æ³¨å†Œä¸­...',
        to_login: 'å·²æœ‰è´¦å·ï¼Ÿç‚¹å‡»ç™»å½•',
        username_len: 'æœ€å¤š16ä¸ªå­—ç¬¦',
        password_hint: 'è‡³å°‘6ä¸ªå­—ç¬¦',
        fill_all: 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ',
        pwd_mismatch: 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´',
        username_toolong: 'ç”¨æˆ·åé•¿åº¦ä¸èƒ½è¶…è¿‡16ä¸ªå­—ç¬¦',
        password_tooshort: 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä¸ªå­—ç¬¦',
        net_fail: 'æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥',
        success_redirect: 'æ³¨å†ŒæˆåŠŸï¼Œå³å°†è·³è½¬åˆ°ç™»å½•é¡µé¢...',
        disabled: 'æ³¨å†ŒåŠŸèƒ½æš‚æ—¶å…³é—­ï¼Œè¯·è”ç³»ç®¡ç†å‘˜',
        status_fetch_fail: 'æ— æ³•è·å–æ³¨å†ŒçŠ¶æ€ï¼Œè¯·ç¨åé‡è¯•'
      },
      billing: {
        title: 'æ£€ç´¢è´¦å•',
        pricing_info: {
          title: 'ğŸ’° è®¡è´¹è¯´æ˜',
          chinese_papers: 'ä¸­æ–‡åˆŠç‰©ï¼šæ¯ç¯‡æ¶ˆè´¹ 1 æ£€ç´¢ç‚¹',
          english_papers: 'è‹±æ–‡åˆŠç‰©ï¼šæ¯ç¯‡æ¶ˆè´¹ 2 æ£€ç´¢ç‚¹',
          distill_discount: 'è’¸é¦æ£€ç´¢ï¼šæ ‡å‡†æ£€ç´¢ä»·æ ¼çš„ 0.1 å€ï¼ˆå³ä¸­æ–‡ 0.1 ç‚¹/ç¯‡ï¼Œè‹±æ–‡ 0.2 ç‚¹/ç¯‡ï¼‰'
        },
        columns: {
          time: 'æ£€ç´¢æ—¶é—´',
          type: 'æ£€ç´¢ç±»å‹',
          count: 'æ£€ç´¢ç¯‡æ•°',
          cost: 'æ£€ç´¢ç‚¹èŠ±è´¹'
        },
        type: {
          normal: 'æ ‡å‡†æ£€ç´¢',
          distill: 'è’¸é¦æ£€ç´¢'
        },
        empty: 'æš‚æ— è´¦å•è®°å½•',
        load_error: 'åŠ è½½è´¦å•å¤±è´¥'
      },
      history: {
        title: 'ğŸ“œ æŸ¥è¯¢å†å²',
        back_home: 'è¿”å›é¦–é¡µ',
        status_loading: 'åŠ è½½ä¸­...',
        total_records: 'å…±æ‰¾åˆ° {n} æ¡æŸ¥è¯¢è®°å½•',
        no_records: 'æš‚æ— æŸ¥è¯¢è®°å½•',
        research_question_empty: 'æ— ç ”ç©¶é—®é¢˜',
        time_and_id: 'æŸ¥è¯¢æ—¶é—´ï¼š{time} | æŸ¥è¯¢IDï¼š{id}',
        range_info: 'æ•°æ®èŒƒå›´ï¼š{folders} | æ—¶é—´èŒƒå›´ï¼š{year}',
        distill_source_info: 'è¢«è’¸é¦çš„æ£€ç´¢çš„æ•°æ®èŒƒå›´ï¼š{question} | è¢«è’¸é¦çš„æ£€ç´¢çš„æ—¶é—´èŒƒå›´ï¼š{time}',
        requirements: 'æŸ¥è¯¢è¦æ±‚ï¼š{req}',
        status_done: 'çŠ¶æ€ï¼šå·²å®Œæˆ',
        status_running: 'çŠ¶æ€ï¼šè¿›è¡Œä¸­',
        download_all_results: 'ä¸‹è½½å…¨éƒ¨åˆ†æç»“æœ',
        download_bib_results: 'ä¸‹è½½ç›¸ç¬¦ç»“æœçš„bibå¼•ç”¨',
        distill: 'ğŸ”¬ è’¸é¦',
        delete: 'ğŸ—‘ï¸ åˆ é™¤',
        delete_confirm: 'ç¡®å®šè¦åˆ é™¤è¿™æ¡æŸ¥è¯¢è®°å½•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚',
        delete_success: 'æŸ¥è¯¢è®°å½•å·²åˆ é™¤',
        delete_fail: 'åˆ é™¤å¤±è´¥ï¼š{msg}',
        pause: 'â¸ï¸ æš‚åœ',
        resume: 'â–¶ï¸ æ¢å¤',
        pause_confirm: 'ç¡®å®šè¦æš‚åœè¿™ä¸ªæŸ¥è¯¢å—ï¼Ÿ',
        resume_confirm: 'ç¡®å®šè¦æ¢å¤è¿™ä¸ªæŸ¥è¯¢å—ï¼Ÿ',
        pause_success: 'æŸ¥è¯¢å·²æš‚åœ',
        pause_fail: 'æš‚åœå¤±è´¥ï¼š{msg}',
        resume_success: 'æŸ¥è¯¢å·²æ¢å¤',
        resume_fail: 'æ¢å¤å¤±è´¥ï¼š{msg}',
        csv_fail: 'ä¸‹è½½CSVå¤±è´¥ï¼š{msg}',
        bib_fail: 'ä¸‹è½½BIBå¤±è´¥ï¼š{msg}',
        user_missing: 'ç”¨æˆ·ä¿¡æ¯ä¸¢å¤±ï¼Œè¯·é‡æ–°ç™»å½•',
        load_fail: 'åŠ è½½å†å²å¤±è´¥ï¼š{msg}',
      },
      distill: {
        title: 'ğŸ”¬ AutoPaperWeb è’¸é¦æ£€ç´¢',
        view_history: 'æŸ¥çœ‹å†å²',
        back_home: 'è¿”å›é¦–é¡µ',
        original_info: 'ğŸ“‹ åŸå§‹æŸ¥è¯¢ä¿¡æ¯',
        loading_original: 'æ­£åœ¨åŠ è½½åŸå§‹æŸ¥è¯¢ä¿¡æ¯...',
        new_config: 'ğŸ” æ–°çš„ç ”ç©¶é…ç½®',
        new_question: 'æ–°çš„ç ”ç©¶é—®é¢˜',
        new_question_ph: 'è¯·è¾“å…¥æ–°çš„ç ”ç©¶é—®é¢˜ï¼Œå°†åŸºäºåŸå§‹æŸ¥è¯¢çš„ç›¸å…³ç»“æœè¿›è¡Œè’¸é¦æ£€ç´¢',
        new_req: 'æ–°çš„ç ”ç©¶è¦æ±‚',
        new_req_ph: 'è¯·è¾“å…¥æ–°çš„å…·ä½“è¦æ±‚ï¼Œä¾‹å¦‚ï¼šé‡ç‚¹å…³æ³¨æœ€æ–°æ–¹æ³•ã€ç‰¹å®šåº”ç”¨åœºæ™¯ç­‰',
        start: 'ğŸš€ å¼€å§‹è’¸é¦',
        starting: 'æ­£åœ¨å¤„ç†...',
        status_ready: 'å‡†å¤‡å¼€å§‹è’¸é¦æ£€ç´¢',
        status_desc: 'å‡†å¤‡åŸºäºåŸå§‹æŸ¥è¯¢çš„ç›¸å…³ç»“æœè¿›è¡Œè’¸é¦',
        err_missing_qid: 'ç¼ºå°‘æŸ¥è¯¢ç´¢å¼•å‚æ•°',
        err_user_missing: 'ç”¨æˆ·ä¿¡æ¯ä¸¢å¤±ï¼Œè¯·é‡æ–°ç™»å½•',
        err_no_question: 'è¯·è¾“å…¥æ–°çš„ç ”ç©¶é—®é¢˜',
        success_redirect: 'è’¸é¦æ£€ç´¢åˆ›å»ºæˆåŠŸï¼Œæ­£åœ¨è·³è½¬...',
        estimated_cost: 'é¢„è®¡æ¶ˆè€—æ£€ç´¢ç‚¹ï¼š{cost}',
        paper_count: 'ç›¸å…³è®ºæ–‡æ•°é‡ï¼š{count}',
        balance: 'å½“å‰ä½™é¢ï¼š{balance}',
        insufficient: 'ä½™é¢ä¸è¶³ï¼Œæ— æ³•å¼€å§‹è’¸é¦',
        // é”™è¯¯æ¶ˆæ¯
        load_original_failed: 'åŠ è½½åŸå§‹æŸ¥è¯¢ä¿¡æ¯å¤±è´¥ï¼š{msg}',
        start_distill_failed: 'å¼€å§‹è’¸é¦å¤±è´¥ï¼š{msg}',
      },
      admin: {
        title: 'ç®¡ç†å‘˜æ§åˆ¶é¢æ¿',
        subtitle: 'ç”¨æˆ·æƒé™å’Œä½™é¢ç®¡ç†',
        loading_users: 'æ­£åœ¨åŠ è½½ç”¨æˆ·æ•°æ®...',
        user_id: 'ç”¨æˆ·ID',
        username: 'ç”¨æˆ·å',
        balance: 'ä½™é¢',
        permission: 'æƒé™',
        permission_rate: 'æ¯åˆ†é’Ÿå¯æŸ¥è¯¢ç¯‡æ•°ï¼ˆé»˜è®¤60-120ï¼‰',
        permission_invalid: 'æ¯åˆ†é’Ÿå¯æŸ¥è¯¢ç¯‡æ•°å¿…é¡»æ˜¯éè´Ÿæ•´æ•°',
        capacity_queue: 'å®¹é‡ä¸é˜Ÿåˆ—çŠ¶æ€',
        backend_label: 'åç«¯ï¼š',
  effective_capacity_label: 'ç³»ç»Ÿæœ€å¤§å®¹é‡ï¼š',
  occupied_capacity_label: 'å·²å ç”¨å®¹é‡ï¼š',
  remaining_capacity_label: 'å‰©ä½™å®¹é‡ï¼š',
        global_backlog_label: 'å…¨å±€æ’é˜Ÿï¼š',
        rds_label: 'RDSï¼š',
        papers_per_min_unit: 'ç¯‡/åˆ†é’Ÿ',
  tokens_per_req_label: 'å•ç¯‡æ–‡çŒ® token æ€»æ¶ˆè€—ï¼š',
  tokens_per_req_hint: 'ç”¨äºè®¡ç®—æœ€å¤§å®¹é‡ï¼šÎ£(TPM_active)/tokens_per_req',
  running_perm_sum_label: 'è¿è¡Œä¸­ä»»åŠ¡æƒé™å’Œï¼š',
  auto_refresh_ms_label: 'é¡µé¢åˆ·æ–°é—´éš”(ms)ï¼š',
        save: 'ä¿å­˜',
        save_limits: 'ä¿å­˜é™é¢',
        api_index: 'APIç´¢å¼•',
        account_name: 'è´¦æˆ·å',
        is_active: 'å¯ç”¨',
        rpm_limit: 'RPMé™é¢',
        used_rpm: 'æœ¬åˆ†é’Ÿå·²ç”¨(RPM)',
        tpm_limit: 'TPMé™é¢',
        used_tpm: 'æœ¬åˆ†é’Ÿå·²ç”¨(TPM)',
        enable: 'å¯ç”¨',
        disable: 'ç¦ç”¨',
        actions: 'æ“ä½œ',
        update: 'æ›´æ–°',
        reset: 'é‡ç½®',
        back_home: 'è¿”å›é¦–é¡µ',
        login: 'ç™»å½•',
        register: 'æ³¨å†Œ',
        update_failed: 'æ›´æ–°å¤±è´¥: {msg}',
        load_failed: 'åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥ï¼š{msg}',
        net_error: 'ç½‘ç»œé”™è¯¯ï¼š{msg}',
        balance_invalid: 'ä½™é¢å¿…é¡»æ˜¯éè´Ÿæ•°',
        update_success: 'ç”¨æˆ· {uid} çš„ä¿¡æ¯å·²æˆåŠŸæ›´æ–°',
        msg_fetch_registration_status_fail: 'æ— æ³•è·å–æ³¨å†ŒçŠ¶æ€',
        msg_fetch_registration_status_error: 'è·å–æ³¨å†ŒçŠ¶æ€å¤±è´¥ï¼š{msg}',
        msg_toggle_failed: 'åˆ‡æ¢å¤±è´¥ï¼š{msg}',
        msg_bcrypt_get_fail: 'æ— æ³•è·å– bcrypt roundsï¼š{msg}',
        msg_invalid_rounds: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ•´æ•° rounds',
        msg_bcrypt_updated: 'bcrypt rounds å·²æ›´æ–°ä¸º {rounds}ï¼ˆä»…å¯¹æ–°å¯†ç ç”Ÿæ•ˆï¼‰',
        msg_capacity_fetch_fail: 'è·å–å®¹é‡å¤±è´¥ï¼š{msg}',
        msg_account_toggled: 'è´¦æˆ·çŠ¶æ€å·²æ›´æ–°',
        msg_toggle_account_fail: 'åˆ‡æ¢è´¦æˆ·å¤±è´¥ï¼š{msg}',
        msg_tokens_per_req_invalid: 'è¯·è¾“å…¥æœ‰æ•ˆçš„ tokens_per_req',
        msg_tokens_per_req_saved: 'å•ç¯‡æ–‡çŒ® token æ€»æ¶ˆè€—å·²æ›´æ–°ä¸º {val}',
        msg_save_failed: 'ä¿å­˜å¤±è´¥ï¼š{msg}',
        msg_auto_refresh_invalid: 'è¯·è¾“å…¥ 1000-60000 ä¹‹é—´çš„æ¯«ç§’å€¼',
        msg_auto_refresh_saved: 'è‡ªåŠ¨åˆ·æ–°é—´éš”å·²æ›´æ–°ä¸º {val} ms',
        msg_limits_invalid: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é™é¢',
        msg_limits_saved: 'é™é¢å·²æ›´æ–°',
        status_enabled: 'å·²å¼€å¯',
        status_disabled: 'å·²å…³é—­',
        worker_seconds_per_item_label: 'å•çº¿ç¨‹æ¯ç¯‡è€—æ—¶(ç§’)ï¼š',
        worker_seconds_per_item_hint: 'ç­‰ä»·äºæ¯çº¿ç¨‹é€Ÿç‡ 60 / X ç¯‡/åˆ†é’Ÿï¼ˆä¿å­˜æ—¶è‡ªåŠ¨æ¢ç®—ï¼‰',
        msg_worker_seconds_invalid: 'è¯·è¾“å…¥æœ‰æ•ˆçš„è€—æ—¶ï¼ˆ>0ï¼‰',
        msg_worker_seconds_saved: 'å•çº¿ç¨‹æ¯ç¯‡è€—æ—¶å·²æ›´æ–°ä¸º {val} ç§’'
      }
    },
    en: {
      common: {
        toggle: 'ä¸­/EN',
        welcome_guest: 'Welcome, Guest',
        welcome_user: 'Welcome, {username}',
        history: 'View History',
        logout: 'Logout',
        back_home: 'Back to Home',
        loading: 'Loading...',
        load_failed: 'Load failed, please refresh',
        confirm: 'OK',
        cancel: 'Cancel',
        // Added: balance label and unit
        balance: 'Balance',
        credit_unit: 'credits',
        billing: 'Billing',
        // History related
        history_title: 'History',
        no_history: 'No history records',
        loading_history: 'Loading history...',
        load_history_failed: 'Failed to load history'
      },
      index: {
        title: 'AutoPaperWeb Research Assistant',
        user_greeting: 'Hello, {username}',
        research_config: 'ğŸ” Research Settings',
        question_label: 'Research Question',
        question_ph: 'Enter your research question, e.g., What is the status of ML in medical diagnosis?',
        req_label: 'Requirements',
        req_ph: 'Enter requirements, e.g., include latest deep learning methods, focus on accuracy and explainability',
        time_range: 'ğŸ“… Time Range',
        include_all_years: 'Include all years',
        start_year: 'Start Year:',
        end_year: 'End Year:',
        folders_title: 'ğŸ“ Data Sources',
        select_all: 'Select All',
        select_none: 'Select None',
        loading_folders: 'Loading data sources...',
        no_folders: 'No data sources available',
        update_stats: 'ğŸ”„ Update Stats',
        start_search: 'ğŸš€ Start Search',
        selected_count: 'Selected Papers: {count}',
        estimated_cost: 'Estimated credits: {cost}',
        need_select_journal: 'Please select at least one journal or conference',
        insufficient_balance: 'Insufficient balance, cannot start search',
        filter_panel: 'Filter Criteria',
        available_journals: 'Available Journals/Conferences',
        selected_journals: 'Selected Journals/Conferences',
        journal_type: 'Journal Type',
        journal_source: 'Journal Source',
        major_category: 'Major Category',
        minor_category: 'Minor Category',
        expand: 'Expand',
        collapse: 'Collapse',
        add_journal: 'Add',
        remove_journal: 'Remove',
        clear_all: 'Clear All',
        journal_count: 'Journals: {count}',
        paper_count: 'Papers: {count}',
        loading_tags: 'Loading tags...',
        loading_journals: 'Loading journals...',
        no_journals_found: 'No matching journals found',
        journal_info: '{name} | {range} | Updated: {date}',
        update_success: 'Stats updated, found {count} related papers',
        update_empty: 'No matching papers, please refine filters',
        need_select_folder: 'Please select at least one data source',
        updating: 'Processing...',
        login_missing: 'User info missing, please re-login',
        err_no_question: 'Please enter a research question',
        err_invalid_year: 'Please enter valid 4-digit years (both start and end), or check Include all years',
        err_year_order: 'End year cannot be earlier than start year',
        search_journals_ph: 'Search journal or conference names...',
        // History related
        new_search: 'New Search',
        current: 'Current',
        history_collapse: 'Collapse History',
        history_expand: 'Expand History',
        // Search summary card related
        search_summary_title: 'ğŸ” Search Overview',
        back_to_input: 'Back to Edit',
        research_question: 'Research Question',
        research_requirements: 'Research Requirements',
        time_range_summary: 'Time Range',
        selected_journals_summary: 'Selected Journals',
        start_time_summary: 'Start Time',
        progress_title: 'Search Progress',
        status_running: 'Running',
        status_paused: 'Paused',
        pause: 'Pause',
        resume: 'Resume',
        pause_confirm: 'Are you sure you want to pause the search?',
        resume_confirm: 'Are you sure you want to resume the search?',
        pause_success: 'Search paused successfully',
        resume_success: 'Search resumed successfully',
        pause_fail: 'Failed to pause search',
        resume_fail: 'Failed to resume search',
        terminate: 'Terminate',
        terminate_confirm: 'Are you sure to terminate this task? This cannot be undone. Processed results will be kept.',
        terminate_success: 'Task terminated',
        terminate_fail: 'Failed to terminate',
        terminate_complete: 'Task Terminated (Partial results available for download)',
        operation_failed: 'Operation failed',
        completion_title: 'Search Completed',
        download_all_results: 'Download All Analysis Results',
        download_bib_results: 'Download BIB Citations of Matching Results',
        distill: 'Distill',
        delete: 'Delete',
        // è’¸é¦ç›¸å…³
        distill_input_title: 'Distillation Input',
        distill_new: 'New',
        distill_question: 'Distillation Research Question',
        distill_question_ph: 'Enter new research question for distillation based on original query results',
        distill_requirements: 'Distillation Research Requirements',
        distill_requirements_ph: 'Enter specific requirements, e.g., focus on latest methods, specific application scenarios',
        distill_paper_count: 'Related Papers: {count}',
        distill_estimated_cost: 'Estimated Cost: {cost} credits',
        distill_user_balance: 'Current Balance: {balance}',
        distill_insufficient_balance: 'Insufficient balance for distillation',
        distill_estimate_failed: 'Cost estimation failed',
        distill_no_question: 'Please enter distillation research question',
        distill_start_success: 'Distillation search created successfully',
        distill_start_failed: 'Failed to create distillation search',
        distill_summary_title: 'Distillation Search',
        distill_running: 'Running',
        distill_completed: 'Completed',
        distillation_completed: 'Distillation Completed',
        download_result: 'Download Result',
        distill_start_time: 'Start Time',
        distill_progress_title: 'Distillation Progress',
        distill_completion_title: 'Distillation Completed',
        distill_again: 'Distill Again',
        distill_pause_not_supported: 'Distillation pause feature is not yet supported',
        estimate_cost: 'Estimate Cost',
        start_distillation: 'Start Distillation',
        collapse: 'Collapse',
        expand: 'Expand',
        close: 'Close',
        no_special_requirements: 'No special requirements',
        download_success: 'Download successful',
        download_failed: 'Download failed',
        distill_confirm: 'Are you sure you want to distill this search?',
        delete_confirm: 'Are you sure you want to delete this search? This action cannot be undone.',
        delete_success: 'Search deleted',
        delete_failed: 'Failed to delete search',
        total_articles: 'Total Articles',
        estimated_cost_summary: 'Estimated Cost',
        search_status: 'Search Status',
        status_running: 'Running',
        // æ–°å¢ï¼šç¡¬ç¼–ç æ–‡æœ¬å›½é™…åŒ–
        updated: 'Updated',
        fetch_failed: 'Fetch failed',
        no_tags: 'No tags available',
        load_failed_short: 'Load failed',
        distill_in_progress: 'Distillation in progress',
        no_journals_search: 'No journals found containing "{keyword}"',
        no_journals_filter: 'No journals found matching criteria',
        add_from_left: 'Please add journals from the left',
        all_years: 'All years',
        history_task_title: 'Historical Task',
        distill_task_title: 'Distillation Search Task',
        loading_history_details: 'Loading task details...',
        load_history_details_failed: 'Failed to load task details',
        view_results: 'View Results',
        download_results: 'Download Results',
        view_progress: 'View Progress',
        create_distill: 'Create Distillation',
        retry: 'Retry',
        feature_coming_soon: 'Feature coming soon',
        login_required: 'Login required',
        loading_short: 'Loading...',
        estimated_cost_points: 'Estimated cost points',
        selected_folders: 'Selected Data Sources',
        year_range: 'Year Range',
        // è’¸é¦ç±»å‹å†å²é¡¹ç›®ä¸“ç”¨æ ‡ç­¾
        distill_original_question_requirements: 'Original Research Question and Requirements',
        distill_original_time: 'Original Search Time Point',
        // é”™è¯¯æ¶ˆæ¯
        update_stats_failed: 'Failed to update stats: {msg}',
        start_search_failed: 'Start search failed: {msg}',
        fetch_balance_failed: 'Failed to fetch balance',
        // è’¸é¦å¡ç‰‡æ ‡ç­¾
        related_papers_count: 'Related papers count:',
        estimated_consumption: 'Estimated consumption:',
        current_balance: 'Current balance:',
        // åŠ è½½é”™è¯¯æ¶ˆæ¯
        load_journals_failed: 'Failed to load journals: {msg}',
        // ä¸‹è½½ç›¸å…³ï¼ˆå¼‚æ­¥é˜Ÿåˆ—æ¨¡å¼ï¼‰
        download_queued: 'Download task created',
        download_processing: 'Generating file...',
        download_ready: 'File ready',
        download_progress: 'Queued, estimated wait {time}s',
        download_generating: 'Generating file...',
        download_please_wait: 'Please wait while generating...',
      },
      login: {
        title: 'User Login',
        username: 'Username:',
        password: 'Password:',
        submit: 'Login',
        submitting: 'Logging in...',
        to_register: "Don't have an account? Register",
        fill_all: 'Please fill username and password',
        net_fail: 'Login failed, please check network',
      },
      register: {
        title: 'User Registration',
        username: 'Username:',
        password: 'Password:',
        confirm: 'Confirm Password:',
        submit: 'Register',
        submitting: 'Registering...',
        to_login: 'Already have an account? Login',
        username_len: 'Up to 16 characters',
        password_hint: 'At least 6 characters',
        fill_all: 'Please fill all fields',
        pwd_mismatch: 'Passwords do not match',
        username_toolong: 'Username cannot exceed 16 chars',
        password_tooshort: 'Password must be at least 6 chars',
        net_fail: 'Registration failed, please check network',
        success_redirect: 'Registration succeeded, redirecting...',
        disabled: 'Registration is currently disabled. Please contact the administrator.',
        status_fetch_fail: 'Failed to fetch registration status, please try again later',
      },
      billing: {
      title: 'Billing',
      pricing_info: {
        title: 'ğŸ’° Pricing Information',
        chinese_papers: 'Chinese Publications: 1 credit per paper',
        english_papers: 'English Publications: 2 credits per paper',
        distill_discount: 'Distillation Search: 0.1x standard price (0.1 credits for Chinese, 0.2 credits for English per paper)'
      },
      columns: {
        time: 'Query Time',
        type: 'Type',
        count: 'Paper Count',
        cost: 'Cost'
      },
      type: {
        normal: 'Search',
        distill: 'Distillation'
      },
      empty: 'No billing records',
      load_error: 'Failed to load billing'
    },
      history: {
        title: 'ğŸ“œ Query History',
        back_home: 'Back to Home',
        status_loading: 'Loading...',
        total_records: '{n} queries found',
        no_records: 'No query records',
        research_question_empty: 'No research question',
        time_and_id: 'Time: {time} | ID: {id}',
        range_info: 'Sources: {folders} | Range: {year}',
        distill_source_info: "Distilled Data Range: {question} | Distilled Time Range: {time}",
        requirements: 'Requirements: {req}',
        status_done: 'Status: Completed',
        status_running: 'Status: In Progress',
        download_all_results: 'Download All Analysis Results',
        download_bib_results: 'Download BIB Citations of Matching Results',
        distill: 'ğŸ”¬ Distill',
        delete: 'ğŸ—‘ï¸ Delete',
        delete_confirm: 'Are you sure you want to delete this query record? This action cannot be undone.',
        delete_success: 'Query record deleted successfully',
        delete_fail: 'Delete failed: {msg}',
        pause: 'â¸ï¸ Pause',
        resume: 'â–¶ï¸ Resume',
        pause_confirm: 'Are you sure you want to pause this query?',
        resume_confirm: 'Are you sure you want to resume this query?',
        pause_success: 'Query paused successfully',
        pause_fail: 'Pause failed: {msg}',
        resume_success: 'Query resumed successfully',
        resume_fail: 'Resume failed: {msg}',
        csv_fail: 'CSV download failed: {msg}',
        bib_fail: 'BIB download failed: {msg}',
        user_missing: 'User info missing, please re-login',
        load_fail: 'Load history failed: {msg}',
      },
      distill: {
        title: 'ğŸ”¬ AutoPaperWeb Distillation',
        view_history: 'View History',
        back_home: 'Back to Home',
        original_info: 'ğŸ“‹ Original Query Info',
        loading_original: 'Loading original query info...',
        new_config: 'ğŸ” New Research Settings',
        new_question: 'New Research Question',
        new_question_ph: 'Enter new research question, distill based on previous relevant results',
        new_req: 'New Requirements',
        new_req_ph: 'Enter new requirements, e.g., latest methods, specific scenarios',
        start: 'ğŸš€ Start Distillation',
        starting: 'Processing...',
        status_ready: 'Ready to start distillation',
        status_desc: 'Preparing to distill based on previous relevant results',
        err_missing_qid: 'Missing query_index',
        err_user_missing: 'User info missing, please re-login',
        err_no_question: 'Please enter a new research question',
        success_redirect: 'Distillation created, redirecting...',
        estimated_cost: 'Estimated credits: {cost}',
        paper_count: 'Related papers: {count}',
        balance: 'Balance: {balance}',
        insufficient: 'Insufficient balance, cannot start distillation',
        // Error messages
        load_original_failed: 'Failed to load original query information: {msg}',
        start_distill_failed: 'Failed to start distillation: {msg}',
      },
      admin: {
        title: 'Admin Control Panel',
        subtitle: 'User permissions and balance management',
        loading_users: 'Loading users...',
        user_id: 'UID',
        username: 'Username',
        balance: 'Balance',
        permission: 'Permission',
        permission_rate: 'Papers per minute (default 60â€“120)',
        permission_invalid: 'Papers per minute must be a non-negative integer',
        capacity_queue: 'Capacity & Queue Status',
        backend_label: 'Backend: ',
  effective_capacity_label: 'System max capacity: ',
  occupied_capacity_label: 'Occupied capacity: ',
  remaining_capacity_label: 'Remaining capacity: ',
        global_backlog_label: 'Global backlog: ',
        rds_label: 'RDS: ',
        papers_per_min_unit: 'papers/min',
  tokens_per_req_label: 'Tokens per paper:',
  tokens_per_req_hint: 'Used to compute max capacity: sum(TPM_active)/tokens_per_req',
  running_perm_sum_label: 'Running permission sum:',
  auto_refresh_ms_label: 'Auto-refresh interval (ms):',
        save: 'Save',
        save_limits: 'Save Limits',
        api_index: 'API Index',
        account_name: 'Account Name',
        is_active: 'Active',
        rpm_limit: 'RPM Limit',
        used_rpm: 'Used this minute (RPM)',
        tpm_limit: 'TPM Limit',
        used_tpm: 'Used this minute (TPM)',
        enable: 'Enable',
        disable: 'Disable',
        actions: 'Actions',
        update: 'Update',
        reset: 'Reset',
        back_home: 'Back to Home',
        login: 'Login',
        register: 'Register',
        update_failed: 'Update failed: {msg}',
        load_failed: 'Failed to load users: {msg}',
        net_error: 'Network error: {msg}',
        balance_invalid: 'Balance must be non-negative',
        update_success: 'User {uid} updated successfully',
        msg_fetch_registration_status_fail: 'Failed to get registration status',
        msg_fetch_registration_status_error: 'Failed to fetch registration status: {msg}',
        msg_toggle_failed: 'Toggle failed: {msg}',
        msg_bcrypt_get_fail: 'Failed to get bcrypt rounds: {msg}',
        msg_invalid_rounds: 'Please enter a valid integer rounds',
        msg_bcrypt_updated: 'bcrypt rounds updated to {rounds} (only affects new passwords)',
        msg_capacity_fetch_fail: 'Failed to fetch capacity: {msg}',
        msg_account_toggled: 'Account status updated',
        msg_toggle_account_fail: 'Failed to toggle account: {msg}',
        msg_tokens_per_req_invalid: 'Please enter a valid tokens_per_req',
        msg_tokens_per_req_saved: 'Tokens per paper updated to {val}',
        msg_save_failed: 'Save failed: {msg}',
        msg_auto_refresh_invalid: 'Please enter milliseconds between 1000 and 60000',
        msg_auto_refresh_saved: 'Auto-refresh interval updated to {val} ms',
        msg_limits_invalid: 'Please enter valid limits',
        msg_limits_saved: 'Limits updated',
        status_enabled: 'Enabled',
        status_disabled: 'Disabled',
        worker_seconds_per_item_label: 'Seconds per paper (per thread):',
        worker_seconds_per_item_hint: 'Equivalent thread rate = 60 / X papers/min (auto converted on save)',
        msg_worker_seconds_invalid: 'Please enter a valid seconds-per-paper (>0)',
        msg_worker_seconds_saved: 'Seconds per paper updated to {val} sec'
      }
    }
  };

  function getLang(){
    const saved = localStorage.getItem(STORAGE_KEY);
    return saved || defaultLang;
  }
  function setLang(lang){
    localStorage.setItem(STORAGE_KEY, lang);
    document.documentElement.lang = (lang === 'zh' ? 'zh-CN' : 'en');
  }
  function tpl(s, params){
    if (!params) return s;
    return s.replace(/\{(\w+)\}/g, (_, k) => (params[k] != null ? params[k] : ''));
  }
  function t(path, params){
    const lang = getLang();
    const segs = path.split('.');
    let cur = dict[lang];
    for (const s of segs){
      if (!cur) break;
      cur = cur[s];
    }
    if (typeof cur === 'string') return tpl(cur, params);
    // fallback
    let curZh = dict['zh'];
    for (const s of segs){
      if (!curZh) break;
      curZh = curZh[s];
    }
    return typeof curZh === 'string' ? tpl(curZh, params) : path;
  }
  function applyI18n(){
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (key) el.textContent = t(key);
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.getAttribute('data-i18n-placeholder');
      if (key) el.setAttribute('placeholder', t(key));
    });
    document.querySelectorAll('[data-i18n-title]').forEach(el => {
      const key = el.getAttribute('data-i18n-title');
      if (key) el.setAttribute('title', t(key));
    });
    
    // æ›´æ–°æ ‡é¢˜ä¸­çš„ç”¨æˆ·åæ˜¾ç¤º
    if (typeof window.updateTitleGreeting === 'function') {
      window.updateTitleGreeting();
    }
  }

  function createToggle(container){
    const btn = document.createElement('button');
    btn.id = 'langToggle';
    btn.style.marginLeft = '10px';
    btn.style.padding = '4px 10px';
    btn.style.borderRadius = '14px';
    btn.style.border = 'none';
    btn.style.cursor = 'pointer';
    btn.style.background = 'rgba(255,255,255,0.2)';
    btn.style.color = '#fff';
    btn.setAttribute('data-i18n', 'common.toggle');
    // ç«‹å³è®¾ç½®åˆå§‹æ–‡æœ¬ï¼Œé¿å…é¦–æ¬¡åŠ è½½ä¸ºç©º
    try { btn.textContent = t('common.toggle'); } catch(e) {}
    btn.addEventListener('click', () => {
      const next = getLang() === 'zh' ? 'en' : 'zh';
      setLang(next);
      applyI18n();
      if (window.apw_afterLangChange) {
        try { window.apw_afterLangChange(next); } catch(e){}
      }
    });
    container.appendChild(btn);
  }

  window.i18n = { t, applyI18n, getLang, setLang };

  document.addEventListener('DOMContentLoaded', () => {
    // é»˜è®¤ä¸­æ–‡
    if (!localStorage.getItem(STORAGE_KEY)) setLang('zh');
    applyI18n();

    // å¦‚æœæœ‰ .user-info å°±æ”¾åœ¨å³ä¸Šè§’ï¼›å¦åˆ™åˆ›å»ºä¸€ä¸ªå›ºå®šæŒ‰é’®
    const ui = document.querySelector('.user-info');
    if (ui) {
      createToggle(ui);
    } else {
      const holder = document.createElement('div');
      holder.style.position = 'fixed';
      holder.style.top = '12px';
      holder.style.right = '12px';
      holder.style.zIndex = '9999';
      createToggle(holder);
      document.body.appendChild(holder);
    }
  });
})();
